@if (investment(); as inv) {
<div class="animate-fade-in">
  <!-- Detail Header -->
  <div class="mb-8">
    <div class="flex flex-col sm:flex-row justify-between sm:items-center">
      <h2 class="text-3xl font-bold text-slate-900">{{ inv.name }}</h2>
      <span class="mt-2 sm:mt-0 px-3 py-1 text-sm font-semibold rounded-full self-start" [class]="inv.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-slate-200 text-slate-600'">
        {{ inv.status | titlecase }}
      </span>
    </div>
    <p class="mt-1 text-slate-500">Started on {{ inv.startDate | date:'longDate' }}</p>
  </div>

  <!-- Detail Cards -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 mb-8">
    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
      <h3 class="text-sm font-medium text-slate-500">Principal</h3>
      <p class="text-xl md:text-2xl font-bold text-slate-800 mt-2">{{ inv.principal | currency:'INR':'symbol':'1.2-2' }}</p>
    </div>
    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
      <h3 class="text-sm font-medium text-slate-500">Interest Rate</h3>
      <p class="text-xl md:text-2xl font-bold text-slate-800 mt-2">{{ inv.interestRate }}% <span class="text-sm font-normal text-slate-500">p.a.</span></p>
    </div>
    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
      <h3 class="text-sm font-medium text-slate-500">Next Payment</h3>
      <p class="text-xl md:text-2xl font-bold text-slate-800 mt-2">{{ getNextPaymentDate(inv) | date:'mediumDate' }}</p>
    </div>
    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
      <h3 class="text-sm font-medium text-slate-500">Interest / Period</h3>
      <p class="text-xl md:text-2xl font-bold text-green-600 mt-2">{{ getInterestPerPeriod(inv) | currency:'INR':'symbol':'1.2-2' }}</p>
    </div>
  </div>
  
  <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
    <div class="lg:col-span-3 space-y-8">
      <!-- Payment Logging -->
      @if (inv.status === 'active') {
        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
          <h3 class="text-xl font-bold text-slate-800 mb-4">Log a Payment</h3>
          <div class="flex items-center gap-4">
            <div class="relative flex-grow">
              <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"><span class="text-gray-500 sm:text-sm">₹</span></div>
              <input type="number" #paymentInput (input)="newPaymentAmount.set(paymentInput.valueAsNumber)" [value]="newPaymentAmount() ?? ''" placeholder="0.00" class="block w-full rounded-md border-slate-300 pl-7 pr-3 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            </div>
            <button (click)="logPayment()" class="bg-indigo-600 text-white font-semibold py-2 px-5 rounded-lg shadow-md hover:bg-indigo-700 transition-colors disabled:bg-indigo-300 disabled:cursor-not-allowed">Log</button>
          </div>
        </div>
      }

      <!-- Payment History -->
      <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
        <h3 class="text-xl font-bold text-slate-800 mb-4">Payment History</h3>
        @if (inv.payments.length > 0) {
          <ul class="divide-y divide-slate-200">
            @for (payment of inv.payments; track payment.id) {
              <li class="py-3 flex justify-between items-center">
                <p class="text-slate-600">{{ payment.date | date:'longDate' }}</p>
                <p class="font-semibold text-green-700">{{ payment.amount | currency:'INR':'symbol':'1.2-2' }}</p>
              </li>
            }
          </ul>
        } @else {
          <p class="text-slate-500 text-sm py-4 text-center">No payments have been logged for this investment yet.</p>
        }
      </div>
    </div>

    <div class="lg:col-span-2 space-y-8">
      <!-- Financial Summary -->
      <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
        <h3 class="text-xl font-bold text-slate-800 mb-4">Financial Summary</h3>
        <ul class="space-y-3 text-sm">
          <li class="flex justify-between items-center">
            <span class="text-slate-500">Principal Amount</span>
            <span class="font-semibold text-slate-700">{{ inv.principal | currency:'INR':'symbol':'1.2-2' }}</span>
          </li>
          <li class="flex justify-between items-center">
            <span class="text-slate-500">Total Paid</span>
            <span class="font-semibold text-green-600">{{ getTotalPaid(inv) | currency:'INR':'symbol':'1.2-2' }}</span>
          </li>
          <li class="flex justify-between items-center border-t border-slate-200 pt-3 mt-3">
            <span class="text-slate-500 font-semibold">Outstanding Balance</span>
            <span class="font-bold text-slate-800">{{ inv.principal - getTotalPaid(inv) | currency:'INR':'symbol':'1.2-2' }}</span>
          </li>
        </ul>
      </div>
      
      <!-- Projections -->
      <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
        <div class="flex justify-between items-center mb-2">
           <h3 class="text-xl font-bold text-slate-800">Foreshadow</h3>
           <span class="font-semibold text-indigo-600">{{ projectionYears() }} Years</span>
        </div>
        <div class="mb-4">
            <label for="projectionYears" class="sr-only">Projection Years</label>
            <input type="range" id="projectionYears" min="1" max="30" [value]="projectionYears()" (input)="onProjectionYearsChange($event)" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
        </div>
        @if (projectedTotalEarnings() > 0) {
        <div class="my-4 p-4 bg-slate-50 rounded-lg">
          <p class="text-sm text-center text-slate-500 mb-3">Projection in {{ projectionYears() }} years</p>
          <div class="flex justify-between items-center text-center">
            <div class="w-1/2">
              <p class="text-xs text-slate-500 uppercase tracking-wider">Invested</p>
              <p class="text-lg font-bold text-slate-800 mt-1">
                {{ inv.principal | currency:'INR':'symbol':'1.2-2' }}
              </p>
            </div>
            <div class="text-slate-300 text-2xl font-light">→</div>
            <div class="w-1/2">
              <p class="text-xs text-slate-500 uppercase tracking-wider">Will Become</p>
              <p class="text-lg font-bold text-green-600 mt-1">
                {{ projectedFutureValue() | currency:'INR':'symbol':'1.2-2' }}
              </p>
            </div>
          </div>
        </div>
        }
        <div #chartContainer class="relative"></div>
      </div>

      <!-- Actions -->
      @if (inv.status === 'active') {
        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
          <h3 class="text-xl font-bold text-slate-800 mb-4">Actions</h3>
          <div class="flex flex-col sm:flex-row gap-4">
            <button (click)="editInvestment.emit(inv)" class="flex-1 w-full text-center bg-slate-100 text-slate-700 font-semibold py-2 px-4 rounded-lg hover:bg-slate-200 transition-colors">Edit Investment</button>
            <button (click)="closeInvestment.emit(inv)" class="flex-1 w-full text-center bg-red-100 text-red-700 font-semibold py-2 px-4 rounded-lg hover:bg-red-200 transition-colors">Settle & Close</button>
          </div>
        </div>
      }
    </div>
  </div>
</div>
}